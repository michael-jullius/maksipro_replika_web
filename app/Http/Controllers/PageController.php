<?php

namespace App\Http\Controllers;
use App\Models\Proyek;
use App\Models\QueryRekapTotal;
use App\Models\QueryAhsPake;
use Illuminate\Http\Request;
use App\Models\Rab;
use App\Models\RabRealisasi;
use App\Models\AhsRealisasi;
use Auth;

class PageController extends Controller
{
    public function ViewDashboard()
    {
        return view('dashboard');
    }

    public function view_preview_rab($id_proyek)
    {
    	$jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan')->groupBy('jenis_pekerjaan')->get();
    	$nama_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('nama_pekerjaan')->groupBy('nama_pekerjaan')->orderBy('nama_pekerjaan')->get();
    	$lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('lantai')->groupBy('lantai')->orderBy('lantai')->get();
    	$kelompok = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->selectRaw('tb_bahan.kelompok')->groupBy('tb_bahan.kelompok')->orderBy('tb_bahan.kelompok')->get();
    	$nama_proyek = Proyek::where('id_user', Auth::user()->id)->where('id', $id_proyek)->first();
        $nama_bahan =  QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->select('nama', 'id_bahan')->groupBy('nama', 'id_bahan')->get();
    	return view('proyek.preview_rab', ['id_proyek'=>$id_proyek, 'nama_proyek'=>$nama_proyek, 'jenis_pekerjaan'=>$jenis_pekerjaan, 'nama_pekerjaan'=>$nama_pekerjaan, 'lantai'=>$lantai, 'kelompok'=>$kelompok, 'nama_bahan'=>$nama_bahan]);
    }

    public function viewPreviewRekap($id_proyek)
    {
    	$data_preview_rekap = Rab::selectRaw("tb_rab.jenis_pekerjaan AS jenis_pekerjaan, @S_BAHAN := CAST(IF(tb_query_harga_satuan_bahan.harga_satuan>0,tb_query_harga_satuan_bahan.harga_satuan,0) AS FLOAT) AS s_bahan,  @S_UPAH := CAST(IF(tb_query_harga_satuan_upah.harga_satuan>0,tb_query_harga_satuan_upah.harga_satuan,0) AS FLOAT) AS s_upah, @S_ALAT := CAST(IF(tb_query_harga_satuan_alat.harga_satuan > 0, tb_query_harga_satuan_alat.harga_satuan, 0) AS FLOAT) AS s_alat,  @S_LAIN := CAST(IF(tb_query_harga_satuan_lain.harga_satuan > 0, tb_query_harga_satuan_lain.harga_satuan, 0 ) AS FLOAT) AS s_lain, (@S_BAHAN + @S_UPAH + @S_ALAT + @S_LAIN) AS s_jumlah, @J_BAHAN := CAST(tb_rab.volume AS FLOAT) * @S_BAHAN AS j_bahan, @J_UPAH := CAST(tb_rab.volume AS FLOAT) * @S_UPAH AS j_upah,  @J_ALAT := CAST(tb_rab.volume AS FLOAT) * @S_ALAT AS j_alat,  @J_LAIN := CAST(tb_rab.volume AS FLOAT) * @S_LAIN AS j_lain, ( @J_BAHAN + @J_UPAH + @J_ALAT + @J_LAIN) AS j_jumlah")->where('tb_rab.id_proyek', $id_proyek)->where('tb_rab.id_user', Auth::user()->id)->leftJoin('tb_query_harga_satuan_bahan', function ($join) {
            $join->on('tb_rab.lantai', '=', 'tb_query_harga_satuan_bahan.keterangan')->whereRaw('tb_rab.kode_analisa = tb_query_harga_satuan_bahan.kode AND tb_rab.id_proyek = tb_query_harga_satuan_bahan.id_proyek');
        	})->leftJoin('tb_query_harga_satuan_alat', function ($join) {
            $join->on('tb_rab.lantai', '=', 'tb_query_harga_satuan_alat.keterangan')->whereRaw('tb_rab.kode_analisa = tb_query_harga_satuan_alat.kode AND tb_rab.id_proyek = tb_query_harga_satuan_alat.id_proyek');
        	})->leftJoin('tb_query_harga_satuan_lain', function ($join) {
            $join->on('tb_rab.lantai', '=', 'tb_query_harga_satuan_lain.keterangan')->whereRaw('tb_rab.kode_analisa = tb_query_harga_satuan_lain.kode AND tb_rab.id_proyek = tb_query_harga_satuan_lain.id_proyek');
        	})->leftJoin('tb_query_harga_satuan_upah', function ($join) {
            $join->on('tb_rab.lantai', '=', 'tb_query_harga_satuan_upah.keterangan')->whereRaw('tb_rab.kode_analisa = tb_query_harga_satuan_upah.kode AND tb_rab.id_proyek = tb_query_harga_satuan_upah.id_proyek');
        	})->get();
    	QueryRekapTotal::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->delete();

    	foreach ($data_preview_rekap as $key => $value) {
    		$qrekap_total = new QueryRekapTotal();
    		$qrekap_total->id_proyek = $id_proyek;
    		$qrekap_total->id_user = Auth::user()->id;
    		$qrekap_total->jenis_pekerjaan = $value->jenis_pekerjaan;
    		$qrekap_total->s_bahan = $value->s_bahan;
    		$qrekap_total->s_upah = $value->s_upah;
    		$qrekap_total->s_alat = $value->s_alat;
    		$qrekap_total->s_lain = $value->s_lain;
    		$qrekap_total->s_jumlah = $value->s_jumlah;
    		$qrekap_total->j_bahan = $value->j_bahan;
    		$qrekap_total->j_upah = $value->j_upah;
    		$qrekap_total->j_alat = $value->j_alat;
    		$qrekap_total->j_lain = $value->j_lain;
    		$qrekap_total->j_jumlah = $value->j_jumlah;
    		$qrekap_total->save();
    	}

    	$data = QueryRekapTotal::selectRaw('jenis_pekerjaan, SUM(j_bahan) AS bahan, SUM(j_upah) AS upah, SUM(j_alat) AS alat, SUM(j_lain) AS lain')->groupBy('jenis_pekerjaan')->where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->get();
    	$jumlah = QueryRekapTotal::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('SUM(j_bahan) AS bahan, SUM(j_upah) AS upah, SUM(j_alat) AS alat, SUM(j_lain) AS lain')->first();
    	return view('proyek.preview_rekap', ['id_proyek'=>$id_proyek, 'data'=>$data, 'jumlah'=>$jumlah]);

    }

    public function viewPreviewRabMenu(Request $request,$id_proyek)
    {
    	if ($request->PrintPreview == 'previewRab') {
    		if ($request->Tampilan == 'singkat') {
    			$jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->get();
    			$lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC');
    			$nama_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->get();
    			$analisa = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
    			$total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->first();
    			return view('proyek.preview_rab_singkat', ['id_proyek'=>$id_proyek, 'jenis_pekerjaan'=>$jenis_pekerjaan, 'lantai'=>$lantai, 'nama_pekerjaan'=>$nama_pekerjaan, 'analisa'=>$analisa, 'total'=>$total]);
    		}elseif ($request->Tampilan == 'penuh') {
    			// $jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->get();
    			$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,tb_bahan.kelompok as kelompok,SUM(jumlah) AS jumlah')->leftJoin('tb_bahan', function ($join) {
            			$join->on('tb_query_ahs_pake.id_bahan', '=', 'tb_bahan.kode');
        			})->groupBy('jenis_pekerjaan', 'tb_bahan.kelompok')->orderByRaw('jenis_pekerjaan ASC')->get();
    			return view('proyek.preview_rab_lengkap', ['id_proyek'=>$id_proyek, 'jenis_pekerjaan'=>$jenis_pekerjaan]);
    		}
    	}elseif ($request->PrintPreview == 'ahs_pekerjaan_yang_dipakai') {
    		$jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->get();
    			$lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai')->groupBy('jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC');
    			$analisa = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, analisa, kode_analisa, satuan_ahs,  SUM(harga_satuan * koefisien) AS jumlah')->groupByRaw('jenis_pekerjaan, lantai, analisa, kode_analisa, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
    			$analisa_satuan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama, id_bahan, satuan_ahs, koefisien, harga_satuan, harga_satuan*koefisien as jumlah')->orderBy('nama')->get();
    			$total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->first();
    			return view('proyek.ahs_pekerjaan_yang_dipakai_rab', ['id_proyek'=>$id_proyek, 'jenis_pekerjaan'=>$jenis_pekerjaan, 'lantai'=>$lantai,  'analisa'=>$analisa, 'analisa_satuan'=>$analisa_satuan, 'total'=>$total]);
    	}elseif ($request->PrintPreview == 'Print_Preview_Kebutuhan_Semua_Bahan') {
    		if ($request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan != 'semua' ) {
    			$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->get();
    			$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->groupBy('jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC');
				$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->orderByRaw('jenis_pekerjaan ASC')->get();
				$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
				$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->orderBy('nama')->get();
				$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->first();

    			if ($request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan != 'semua') {
    				$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->groupBy('jenis_pekerjaan','lantai')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->orderByRaw('jenis_pekerjaan ASC');
					$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
					$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
					$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->orderBy('tb_query_ahs_pake.nama')->get();
					$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->selectRaw('SUM(jumlah) AS jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->first();

					if ($request->Print_Preview_Kebutuhan_Semua_Bahan_lantai != 'semua') {
						$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->get();
	    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->orderByRaw('jenis_pekerjaan ASC');
						$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
						$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
						$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
						$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->selectRaw('SUM(jumlah) AS jumlah')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->first();


						if ($request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok != 'semua') {
							$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->get();
		    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC');
							$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
							$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderBy('tb_query_ahs_pake.nama')->get();
							$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->selectRaw('SUM(jumlah) AS jumlah')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->first();
						}else{
							$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->get();
		    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->orderByRaw('jenis_pekerjaan ASC');
							$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
							$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
							$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->selectRaw('SUM(jumlah) AS jumlah')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->first();
						}
					}else{
						$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
	    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->orderByRaw('jenis_pekerjaan ASC');
						$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
						$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
						$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
						$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->selectRaw('SUM(jumlah) AS jumlah')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->first();
						if ($request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok != 'semua') {
							$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->get();
		    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC');
							$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
							$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderBy('tb_query_ahs_pake.nama')->get();
							$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->selectRaw('SUM(jumlah) AS jumlah')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->first();
						}else{
							$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
		    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->orderByRaw('jenis_pekerjaan ASC');
							$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
							$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
							$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->selectRaw('SUM(jumlah) AS jumlah')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->first();
						}
					}

    			}else{
    				$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->get();
					$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC');
					$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->get();
					$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
					$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
					$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->selectRaw('SUM(jumlah) AS jumlah')->first();
                    if ($request->Print_Preview_Kebutuhan_Semua_Bahan_lantai != 'semua') {
						$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->get();
	    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->orderByRaw('jenis_pekerjaan ASC');
						$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->get();
						$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
						$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
						$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->selectRaw('SUM(jumlah) AS jumlah')->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->first();


						if ($request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok != 'semua') {
							$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->get();
		    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC');
							$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderBy('tb_query_ahs_pake.nama')->get();
							$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->selectRaw('SUM(jumlah) AS jumlah')->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->first();
						}else{
							$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->get();
		    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->orderByRaw('jenis_pekerjaan ASC');
							$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
							$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->selectRaw('SUM(jumlah) AS jumlah')->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->first();
						}
					}else{
						$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->get();
	    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC');
						$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->get();
						$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
						$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
						$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->selectRaw('SUM(jumlah) AS jumlah')->where('tb_query_ahs_pake.id_user', Auth::user()->id)->first();
						if ($request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok != 'semua') {
							$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->get();
		    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC');
							$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderBy('tb_query_ahs_pake.nama')->get();
							$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->selectRaw('SUM(jumlah) AS jumlah')->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->first();
						}else{
							$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->get();
		    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC');
							$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
							$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('jenis_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_jenis_pekerjaan)->selectRaw('SUM(jumlah) AS jumlah')->where('tb_query_ahs_pake.id_user', Auth::user()->id)->first();
						}
					}
		    	}
    		}else{
	    		$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->get();
				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC');
				$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->get();
				$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
				$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
				$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->first();

                if ($request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan != 'semua') {
    				$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->groupBy('jenis_pekerjaan','lantai')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->orderByRaw('jenis_pekerjaan ASC');
					$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
					$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
					$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->orderBy('tb_query_ahs_pake.nama')->get();
					$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->first();

					if ($request->Print_Preview_Kebutuhan_Semua_Bahan_lantai != 'semua') {
						$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->get();
	    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->orderByRaw('jenis_pekerjaan ASC');
						$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
						$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
						$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
						$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->first();


						if ($request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok != 'semua') {
							$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->get();
		    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC');
							$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
							$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderBy('tb_query_ahs_pake.nama')->get();
							$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->first();
						}else{
							$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->get();
		    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->orderByRaw('jenis_pekerjaan ASC');
							$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
							$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
							$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->first();
						}
					}else{
						$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
	    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->orderByRaw('jenis_pekerjaan ASC');
						$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
						$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
						$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
						$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->first();
						if ($request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok != 'semua') {
							$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->get();
		    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC');
							$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
							$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderBy('tb_query_ahs_pake.nama')->get();
							$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->first();
						}else{
							$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
		    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->orderByRaw('jenis_pekerjaan ASC');
							$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->get();
							$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
							$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->where('nama_pekerjaan', $request->Print_Preview_Kebutuhan_Semua_Bahan_nama_pekerjaan)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->first();
						}
					}

    			}else{
    				$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->get();
					$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC');
					$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->get();
					$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
					$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
					$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->first();
                    if ($request->Print_Preview_Kebutuhan_Semua_Bahan_lantai != 'semua') {
						$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->get();
	    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->orderByRaw('jenis_pekerjaan ASC');
						$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->get();
						$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
						$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
						$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->first();


						if ($request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok != 'semua') {
							$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->get();
		    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC');
							$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderBy('tb_query_ahs_pake.nama')->get();
							$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->first();
						}else{
							$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->get();
		    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->orderByRaw('jenis_pekerjaan ASC');
							$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
							$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('lantai', $request->Print_Preview_Kebutuhan_Semua_Bahan_lantai)->first();
						}
					}else{
						$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->get();
	    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC');
						$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->get();
						$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
						$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
						$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->where('tb_query_ahs_pake.id_user', Auth::user()->id)->first();
						if ($request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok != 'semua') {
							$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->get();
		    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC');
							$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->orderBy('tb_query_ahs_pake.nama')->get();
							$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->where('tb_query_ahs_pake.id_user', Auth::user()->id)->where('tb_bahan.kelompok', $request->Print_Preview_Kebutuhan_Semua_Bahan_kelompok)->first();
						}else{
							$jenis_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan')->orderByRaw('jenis_pekerjaan ASC')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->get();
		    				$lantai = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC');
							$nama_pekerjaan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('kode_pekerjaan, nama_pekerjaan, jenis_pekerjaan, lantai, SUM(jumlah) AS jumlah')->groupBy('kode_pekerjaan','nama_pekerjaan', 'jenis_pekerjaan','lantai')->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa,volume, satuan_ahs, SUM(jumlah) AS jumlah')->groupByRaw('jenis_pekerjaan , nama_pekerjaan, lantai, analisa, kode_pekerjaan, kode_analisa, volume, satuan_ahs')->orderByRaw('jenis_pekerjaan ASC')->get();
							$analisa_satuan = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan,lantai,analisa, nama_pekerjaan, tb_query_ahs_pake.nama, id_bahan, satuan_ahs, harga_satuan, volume, jumlah')->orderBy('tb_query_ahs_pake.nama')->get();
							$total = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->where('tb_query_ahs_pake.id_user', Auth::user()->id)->first();
						}
					}
		    	}
	    	}
    	    return view('proyek.preview_kebutuhan_semua_bahan', ['id_proyek'=>$id_proyek, 'jenis_pekerjaan'=>$jenis_pekerjaan, 'lantai'=>$lantai, 'nama_pekerjaan'=>$nama_pekerjaan, 'analisa'=>$analisa, 'total'=>$total, 'analisa_satuan'=>$analisa_satuan]);


    	}elseif ($request->PrintPreview == 'Print_Preview_Kebutuhan_Per_Bahan'){
            if ($request->nama_bahan == 'semua') {
                $sumber_daya = QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('tb_bahan.kelompok as kelompok, SUM(jumlah) as jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->groupBy('tb_bahan.kelompok')->get();
                $sumber_daya_detail =  QueryAhsPake::where('tb_query_ahs_pake.id_proyek', $id_proyek)->where('tb_query_ahs_pake.id_user', Auth::user()->id)->selectRaw('tb_bahan.kelompok as kelompok, tb_query_ahs_pake.id_bahan, tb_query_ahs_pake.nama, tb_query_ahs_pake.harga_satuan, SUM(tb_query_ahs_pake.volume * tb_query_ahs_pake.koefisien) as volume, tb_query_ahs_pake.satuan, SUM(jumlah) as jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_query_ahs_pake.id_proyek = tb_bahan.id_proyek');})->groupByRaw('tb_bahan.kelompok, id_bahan, nama, harga_satuan, satuan')->get();
                $total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('SUM(jumlah) AS jumlah')->first();
                return view('proyek.preview_kebutuhan_per_bahan', ['id_proyek'=>$id_proyek, 'sumber_daya'=>$sumber_daya, 'sumber_daya_detail'=>$sumber_daya_detail, 'total'=>$total]);
            }else{
                $jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan', 'satuan')->where('id_bahan', $request->nama_bahan)->get();
                $lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->get();
                $pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, kode_pekerjaan, nama_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('kode_pekerjaan', 'nama_pekerjaan', 'jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->get();
                $total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('satuan, SUM(volume*koefisien) as volume,  SUM(jumlah) AS jumlah')->where('id_bahan', $request->nama_bahan)->groupBy('satuan')->first();
                $item = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('nama, id_bahan, harga_satuan')->where('id_bahan', $request->nama_bahan)->first();

                if ($request->kelompok_pekerjaan_data != 'semua') {
                    $jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->get();
                    $lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->get();
                    $pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, kode_pekerjaan, nama_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('kode_pekerjaan', 'nama_pekerjaan', 'jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->get();
                    $total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('satuan, SUM(volume*koefisien) as volume,  SUM(jumlah) AS jumlah')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->groupBy('satuan')->first();
                    $item = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('nama, id_bahan, harga_satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->first();

                    if ($request->nama_pekerjaan_data != 'semua') {
                        $jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->get();
                        $lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->get();
                        $pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, kode_pekerjaan, nama_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('kode_pekerjaan', 'nama_pekerjaan', 'jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->get();
                        $total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('satuan, SUM(volume*koefisien) as volume,  SUM(jumlah) AS jumlah')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->groupBy('satuan')->where('nama_pekerjaan', $request->nama_pekerjaan_data)->first();
                        $item = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('nama, id_bahan, harga_satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->first();
						if ($request->lantai_data != 'semua') {
                            $jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->where('lantai', $request->lantai_data)->get();
                            $lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->where('lantai', $request->lantai_data)->get();
                            $pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, kode_pekerjaan, nama_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('kode_pekerjaan', 'nama_pekerjaan', 'jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->where('lantai', $request->lantai_data)->get();
                            $total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('satuan, SUM(volume*koefisien) as volume,  SUM(jumlah) AS jumlah')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->groupBy('satuan')->where('nama_pekerjaan', $request->nama_pekerjaan_data)->where('lantai', $request->lantai_data)->first();
                            $item = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('nama, id_bahan, harga_satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->where('lantai', $request->lantai_data)->first();
                        }else{
                            $jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->get();
                            $lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->get();
                            $pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, kode_pekerjaan, nama_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('kode_pekerjaan', 'nama_pekerjaan', 'jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->get();
                            $total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('satuan, SUM(volume*koefisien) as volume,  SUM(jumlah) AS jumlah')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->groupBy('satuan')->where('nama_pekerjaan', $request->nama_pekerjaan_data)->first();
                            $item = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('nama, id_bahan, harga_satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->first();
                        }
                    }else{
                        $jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->get();
                        $lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->get();
                        $pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, kode_pekerjaan, nama_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('kode_pekerjaan', 'nama_pekerjaan', 'jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->get();
                        $total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('satuan, SUM(volume*koefisien) as volume,  SUM(jumlah) AS jumlah')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->groupBy('satuan')->first();
                        $item = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('nama, id_bahan, harga_satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->first();
                        if ($request->lantai_data != 'semua') {
                            $jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->where('lantai', $request->lantai_data)->get();
                            $lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->where('lantai', $request->lantai_data)->get();
                            $pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, kode_pekerjaan, nama_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('kode_pekerjaan', 'nama_pekerjaan', 'jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->where('lantai', $request->lantai_data)->get();
                            $total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('satuan, SUM(volume*koefisien) as volume,  SUM(jumlah) AS jumlah')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->groupBy('satuan')->where('lantai', $request->lantai_data)->first();
                            $item = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('nama, id_bahan, harga_satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->where('lantai', $request->lantai_data)->first();
                        }else{
                            $jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->get();
                            $lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->get();
                            $pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, kode_pekerjaan, nama_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('kode_pekerjaan', 'nama_pekerjaan', 'jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->get();
                            $total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('satuan, SUM(volume*koefisien) as volume,  SUM(jumlah) AS jumlah')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->groupBy('satuan')->first();
                            $item = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('nama, id_bahan, harga_satuan')->where('id_bahan', $request->nama_bahan)->where('jenis_pekerjaan', $request->kelompok_pekerjaan_data)->first();
                        }
                    }
               }else{
                    $jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan', 'satuan')->where('id_bahan', $request->nama_bahan)->get();
                    $lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->get();
                    $pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, kode_pekerjaan, nama_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('kode_pekerjaan', 'nama_pekerjaan', 'jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->get();
                    $total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('satuan, SUM(volume*koefisien) as volume,  SUM(jumlah) AS jumlah')->where('id_bahan', $request->nama_bahan)->groupBy('satuan')->first();
                    $item = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('nama, id_bahan, harga_satuan')->where('id_bahan', $request->nama_bahan)->first();
                    if ($request->nama_pekerjaan_data != 'semua') {
                        $jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan', 'satuan')->where('id_bahan', $request->nama_bahan)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->get();
                        $lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->get();
                        $pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, kode_pekerjaan, nama_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('kode_pekerjaan', 'nama_pekerjaan', 'jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->get();
                        $total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('satuan, SUM(volume*koefisien) as volume,  SUM(jumlah) AS jumlah')->where('id_bahan', $request->nama_bahan)->groupBy('satuan')->where('nama_pekerjaan', $request->nama_pekerjaan_data)->first();
                        $item = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('nama, id_bahan, harga_satuan')->where('id_bahan', $request->nama_bahan)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->first();
						if ($request->lantai_data != 'semua') {
                            $jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan', 'satuan')->where('id_bahan', $request->nama_bahan)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->where('lantai', $request->lantai_data)->get();
                            $lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->where('lantai', $request->lantai_data)->get();
                            $pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, kode_pekerjaan, nama_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('kode_pekerjaan', 'nama_pekerjaan', 'jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->where('lantai', $request->lantai_data)->get();
                            $total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('satuan, SUM(volume*koefisien) as volume,  SUM(jumlah) AS jumlah')->where('id_bahan', $request->nama_bahan)->groupBy('satuan')->where('nama_pekerjaan', $request->nama_pekerjaan_data)->where('lantai', $request->lantai_data)->first();
                            $item = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('nama, id_bahan, harga_satuan')->where('id_bahan', $request->nama_bahan)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->where('lantai', $request->lantai_data)->first();
                        }else{
                            $jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan', 'satuan')->where('id_bahan', $request->nama_bahan)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->get();
                            $lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->get();
                            $pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, kode_pekerjaan, nama_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('kode_pekerjaan', 'nama_pekerjaan', 'jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->get();
                            $total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('satuan, SUM(volume*koefisien) as volume,  SUM(jumlah) AS jumlah')->where('id_bahan', $request->nama_bahan)->groupBy('satuan')->where('nama_pekerjaan', $request->nama_pekerjaan_data)->first();
                            $item = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('nama, id_bahan, harga_satuan')->where('id_bahan', $request->nama_bahan)->where('nama_pekerjaan', $request->nama_pekerjaan_data)->first();
                        }
                    }else{
                        $jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan', 'satuan')->where('id_bahan', $request->nama_bahan)->get();
                        $lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->get();
                        $pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, kode_pekerjaan, nama_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('kode_pekerjaan', 'nama_pekerjaan', 'jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->get();
                        $total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('satuan, SUM(volume*koefisien) as volume,  SUM(jumlah) AS jumlah')->where('id_bahan', $request->nama_bahan)->groupBy('satuan')->first();
                        $item = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('nama, id_bahan, harga_satuan')->where('id_bahan', $request->nama_bahan)->first();
                        if ($request->lantai_data != 'semua') {
                            $jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan', 'satuan')->where('id_bahan', $request->nama_bahan)->where('lantai', $request->lantai_data)->get();
                            $lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('lantai', $request->lantai_data)->get();
                            $pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, kode_pekerjaan, nama_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('kode_pekerjaan', 'nama_pekerjaan', 'jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->where('lantai', $request->lantai_data)->get();
                            $total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('satuan, SUM(volume*koefisien) as volume,  SUM(jumlah) AS jumlah')->where('id_bahan', $request->nama_bahan)->groupBy('satuan')->where('lantai', $request->lantai_data)->first();
                            $item = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('nama, id_bahan, harga_satuan')->where('id_bahan', $request->nama_bahan)->where('lantai', $request->lantai_data)->first();
                        }else{
                            $jenis_pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan', 'satuan')->where('id_bahan', $request->nama_bahan)->get();
                            $lantai = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->get();
                            $pekerjaan = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('jenis_pekerjaan, lantai, kode_pekerjaan, nama_pekerjaan, SUM(volume*koefisien) as volume, satuan, SUM(jumlah) as jumlah')->groupBy('kode_pekerjaan', 'nama_pekerjaan', 'jenis_pekerjaan','lantai', 'satuan')->where('id_bahan', $request->nama_bahan)->get();
                            $total = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('satuan, SUM(volume*koefisien) as volume,  SUM(jumlah) AS jumlah')->where('id_bahan', $request->nama_bahan)->groupBy('satuan')->first();
                            $item = QueryAhsPake::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('nama, id_bahan, harga_satuan')->where('id_bahan', $request->nama_bahan)->first();
                        }
                    }
                }
                if (is_null($item)) {
                    return redirect()->back()->with('alert', 'masukan bahan terlebih dahulu');
                }
                return view('proyek.preview_kebutuhan_per_bahan_detail',['id_proyek'=>$id_proyek,'total'=>$total,'item'=>$item, 'jenis_pekerjaan'=>$jenis_pekerjaan, 'lantai'=>$lantai, 'pekerjaan'=>$pekerjaan]);

            }
        }
    }

    public function viewAhsPekerjaan($id_proyek)
    {
        $lantai = AhsRealisasi::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('keterangan')->groupBy('keterangan')->orderBy('keterangan')->get();
        $jenis_pekerjaan = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->selectRaw('jenis_pekerjaan')->groupBy('jenis_pekerjaan')->get();
        $data = array('kode'=>'', 'lantai'=>'', 'pekerjaan'=>'', 'satuan'=>'');
        $nama_proyek = Proyek::where('id_user', Auth::user()->id)->where('id', $id_proyek)->first();
        return view('proyek.ahs_pekerjaan', ['nama_proyek'=>$nama_proyek, 'id_proyek'=>$id_proyek, 'data'=>$data, 'jenis_pekerjaan'=>$jenis_pekerjaan, 'lantai'=>$lantai]);
    }

    public function viewAhsPekerjaanFilter(Request $request, $id_proyek)
    {
        $data = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->selectRaw('tb_ahs_realisasi.keterangan, tb_ahs_realisasi.kode, tb_ahs_data.analisa_pekerjaan, tb_ahs_data.satuan')->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->where('tb_ahs_data.jenis_pekerjaan', $request->nama_pekerjaan)->where('tb_ahs_realisasi.keterangan', $request->lantai)->groupByRaw('tb_ahs_realisasi.keterangan, tb_ahs_realisasi.kode, tb_ahs_data.analisa_pekerjaan, tb_ahs_data.satuan')->get();
        $lantai_data = AhsRealisasi::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('keterangan')->groupBy('keterangan')->orderBy('keterangan')->get();
        $jenis_pekerjaan = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->selectRaw('jenis_pekerjaan')->groupBy('jenis_pekerjaan')->get();
        $nama_proyek = Proyek::where('id_user', Auth::user()->id)->where('id', $id_proyek)->first();

        $nama_pekerjaan = $request->nama_pekerjaan;
        $lantai = $request->lantai;
        return view('proyek.ahs_pekerjaan_filter', ['nama_proyek'=>$nama_proyek, 'id_proyek'=>$id_proyek, 'jenis_pekerjaan'=>$jenis_pekerjaan, 'lantai'=>$lantai, 'data'=>$data, 'lantai_data'=>$lantai_data, 'nama_pekerjaan'=>$nama_pekerjaan]);

    }
    public function viewAhsPekerjaanFilterPreview(Request $request, $id_proyek, $nama_pekerjaan, $lantai)
    {
        if (is_null($request->radio)) {
            return redirect()->route('viewAhsPekerjaan', $id_proyek)->with('alert', 'pilih dulu Nama Pekerjaan nya');
        }
        else{
            $data = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->selectRaw('tb_ahs_realisasi.keterangan, tb_ahs_realisasi.kode, tb_ahs_data.analisa_pekerjaan, tb_ahs_data.satuan')->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->where('tb_ahs_data.jenis_pekerjaan', $request->nama_pekerjaan)->where('tb_ahs_realisasi.keterangan', $request->lantai)->groupByRaw('tb_ahs_realisasi.keterangan, tb_ahs_realisasi.kode, tb_ahs_data.analisa_pekerjaan, tb_ahs_data.satuan')->get();
            $lantai_data = AhsRealisasi::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->selectRaw('keterangan')->groupBy('keterangan')->orderBy('keterangan')->get();
            $jenis_pekerjaan = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->selectRaw('jenis_pekerjaan')->groupBy('jenis_pekerjaan')->get();
            $nama_proyek = Proyek::where('id_user', Auth::user()->id)->where('id', $id_proyek)->first();
            $data_preview = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->selectRaw('tb_ahs_realisasi.id_bahan, tb_bahan.nama, tb_bahan.satuan, tb_ahs_realisasi.koefisien, tb_bahan.harga')->leftJoin('tb_bahan', function ($join) {$join->on('tb_ahs_realisasi.id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->groupByRaw('tb_ahs_realisasi.id_bahan, tb_bahan.nama, tb_bahan.satuan, tb_ahs_realisasi.koefisien, tb_bahan.harga')->where('tb_ahs_realisasi.kode', $request->radio)->get();
            $total_persentase = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->selectRaw('tb_bahan.kelompok, SUM(tb_ahs_realisasi.koefisien * tb_bahan.harga) as jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('tb_ahs_realisasi.id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->where('tb_ahs_realisasi.kode', $request->radio)->groupBy('tb_bahan.kelompok')->get();
            $total = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->selectRaw('SUM(tb_ahs_realisasi.koefisien * tb_bahan.harga) as jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('tb_ahs_realisasi.id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->where('tb_ahs_realisasi.kode', $request->radio)->first();
            $radio = $request->radio;
            $selected = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->where('tb_ahs_realisasi.kode', $request->radio)->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->selectRaw('tb_ahs_realisasi.keterangan, tb_ahs_realisasi.kode, tb_ahs_data.analisa_pekerjaan, tb_ahs_data.satuan')->groupByRaw('tb_ahs_realisasi.keterangan, tb_ahs_realisasi.kode, tb_ahs_data.analisa_pekerjaan, tb_ahs_data.satuan')->first();
	    return view('proyek.ahs_pekerjaan_filter_preview', ['nama_proyek'=>$nama_proyek, 'id_proyek'=>$id_proyek, 'jenis_pekerjaan'=>$jenis_pekerjaan, 'lantai'=>$lantai, 'data'=>$data, 'lantai_data'=>$lantai_data, 'nama_pekerjaan'=>$nama_pekerjaan, 'data_preview'=>$data_preview, 'total_persentase'=>$total_persentase, 'total'=>$total, 'radio'=>$radio, 'selected'=>$selected]);
        }
    }

    public function cetakSemuaAhsPekerjaan($id_proyek)
    {
        $jenis_pekerjaan = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->selectRaw('tb_ahs_data.jenis_pekerjaan, SUM(tb_bahan.harga * tb_ahs_realisasi.koefisien) AS jumlah')->groupByRaw('tb_ahs_data.jenis_pekerjaan')->get();
        $lantai = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->selectRaw('tb_ahs_data.jenis_pekerjaan, tb_ahs_realisasi.keterangan, SUM(tb_bahan.harga * tb_ahs_realisasi.koefisien) AS jumlah')->groupByRaw('tb_ahs_realisasi.keterangan, tb_ahs_data.jenis_pekerjaan')->orderBy('tb_ahs_data.jenis_pekerjaan')->get();
        $analisa = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->selectRaw('tb_ahs_data.jenis_pekerjaan, tb_ahs_data.satuan, tb_ahs_realisasi.kode, tb_ahs_realisasi.keterangan, tb_ahs_data.analisa_pekerjaan, SUM(tb_bahan.harga * tb_ahs_realisasi.koefisien) AS jumlah')->groupByRaw('tb_ahs_realisasi.kode, tb_ahs_realisasi.keterangan, tb_ahs_data.satuan,tb_ahs_data.jenis_pekerjaan, tb_ahs_data.analisa_pekerjaan')->orderBy('tb_ahs_data.jenis_pekerjaan')->get();
        $analisa_satuan = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->selectRaw('tb_bahan.kode, tb_bahan.satuan, tb_ahs_realisasi.koefisien, tb_bahan.harga ,tb_ahs_data.jenis_pekerjaan, tb_ahs_realisasi.keterangan, tb_ahs_data.analisa_pekerjaan, tb_bahan.nama, SUM(tb_bahan.harga * tb_ahs_realisasi.koefisien) AS jumlah')->groupByRaw('tb_bahan.kode, tb_bahan.satuan, tb_ahs_realisasi.koefisien, tb_bahan.harga, tb_ahs_realisasi.keterangan, tb_ahs_data.jenis_pekerjaan, tb_ahs_data.analisa_pekerjaan, tb_bahan.nama')->orderBy('tb_ahs_data.jenis_pekerjaan')->get();
        $total = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->selectRaw('SUM(tb_ahs_realisasi.koefisien * tb_bahan.harga) as jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('tb_ahs_realisasi.id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->first();
        $total_persentase = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->selectRaw('tb_bahan.kelompok, SUM(tb_ahs_realisasi.koefisien * tb_bahan.harga) as jumlah')->leftJoin('tb_bahan', function ($join) {$join->on('tb_ahs_realisasi.id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->groupBy('tb_bahan.kelompok')->get();
        return view('proyek.cetak_ahs_pekerjaan', ['id_proyek'=>$id_proyek, 'jenis_pekerjaan'=>$jenis_pekerjaan, 'lantai'=>$lantai,'analisa'=>$analisa, 'total'=>$total, 'analisa_satuan'=>$analisa_satuan, 'total_persentase'=>$total_persentase]);
    }
    public function cetakFilterAhsPekerjaan($id_proyek,$nama_pekerjaan,$lantai_data)
    {
        $jenis_pekerjaan = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->selectRaw('tb_ahs_data.jenis_pekerjaan, SUM(tb_bahan.harga * tb_ahs_realisasi.koefisien) AS jumlah')->groupByRaw('tb_ahs_data.jenis_pekerjaan')->where('tb_ahs_data.jenis_pekerjaan',$nama_pekerjaan)->get();
        $lantai = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->selectRaw('tb_ahs_data.jenis_pekerjaan, tb_ahs_realisasi.keterangan, SUM(tb_bahan.harga * tb_ahs_realisasi.koefisien) AS jumlah')->groupByRaw('tb_ahs_realisasi.keterangan, tb_ahs_data.jenis_pekerjaan')->orderBy('tb_ahs_data.jenis_pekerjaan')->where('tb_ahs_realisasi.keterangan', $lantai_data)->get();
        $analisa = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->selectRaw('tb_ahs_data.jenis_pekerjaan, tb_ahs_data.satuan, tb_ahs_realisasi.kode, tb_ahs_realisasi.keterangan, tb_ahs_data.analisa_pekerjaan, SUM(tb_bahan.harga * tb_ahs_realisasi.koefisien) AS jumlah')->groupByRaw('tb_ahs_realisasi.kode, tb_ahs_realisasi.keterangan, tb_ahs_data.satuan,tb_ahs_data.jenis_pekerjaan, tb_ahs_data.analisa_pekerjaan')->orderBy('tb_ahs_data.jenis_pekerjaan')->where('tb_ahs_data.jenis_pekerjaan',$nama_pekerjaan)->where('tb_ahs_realisasi.keterangan', $lantai_data)->get();
        $analisa_satuan = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->selectRaw('tb_bahan.kode, tb_bahan.satuan, tb_ahs_realisasi.koefisien, tb_bahan.harga ,tb_ahs_data.jenis_pekerjaan, tb_ahs_realisasi.keterangan, tb_ahs_data.analisa_pekerjaan, tb_bahan.nama, SUM(tb_bahan.harga * tb_ahs_realisasi.koefisien) AS jumlah')->groupByRaw('tb_bahan.kode, tb_bahan.satuan, tb_ahs_realisasi.koefisien, tb_bahan.harga, tb_ahs_realisasi.keterangan, tb_ahs_data.jenis_pekerjaan, tb_ahs_data.analisa_pekerjaan, tb_bahan.nama')->orderBy('tb_ahs_data.jenis_pekerjaan')->where('tb_ahs_data.jenis_pekerjaan',$nama_pekerjaan)->where('tb_ahs_realisasi.keterangan', $lantai_data)->get();
        $total = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->selectRaw('SUM(tb_ahs_realisasi.koefisien * tb_bahan.harga) as jumlah')->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->leftJoin('tb_bahan', function ($join) {$join->on('tb_ahs_realisasi.id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->where('tb_ahs_data.jenis_pekerjaan',$nama_pekerjaan)->where('tb_ahs_realisasi.keterangan', $lantai_data)->first();
        $total_persentase = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->selectRaw('tb_bahan.kelompok, SUM(tb_ahs_realisasi.koefisien * tb_bahan.harga) as jumlah')->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->leftJoin('tb_bahan', function ($join) {$join->on('tb_ahs_realisasi.id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->groupBy('tb_bahan.kelompok')->where('tb_ahs_data.jenis_pekerjaan',$nama_pekerjaan)->where('tb_ahs_realisasi.keterangan', $lantai_data)->get();
        return view('proyek.cetak_ahs_pekerjaan', ['id_proyek'=>$id_proyek, 'jenis_pekerjaan'=>$jenis_pekerjaan, 'lantai'=>$lantai,'analisa'=>$analisa, 'total'=>$total, 'analisa_satuan'=>$analisa_satuan, 'total_persentase'=>$total_persentase]);
    }
     public function cetakFilterFullAhsPekerjaan($id_proyek,$nama_pekerjaan,$lantai_data, $kode)
    {
        $jenis_pekerjaan = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->selectRaw('tb_ahs_data.jenis_pekerjaan, SUM(tb_bahan.harga * tb_ahs_realisasi.koefisien) AS jumlah')->groupByRaw('tb_ahs_data.jenis_pekerjaan')->where('tb_ahs_data.jenis_pekerjaan',$nama_pekerjaan)->where('tb_ahs_realisasi.kode',$kode)->get();
        $lantai = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->selectRaw('tb_ahs_data.jenis_pekerjaan, tb_ahs_realisasi.keterangan, SUM(tb_bahan.harga * tb_ahs_realisasi.koefisien) AS jumlah')->groupByRaw('tb_ahs_realisasi.keterangan, tb_ahs_data.jenis_pekerjaan')->orderBy('tb_ahs_data.jenis_pekerjaan')->where('tb_ahs_realisasi.keterangan', $lantai_data)->where('tb_ahs_realisasi.kode',$kode)->get();
        $analisa = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->selectRaw('tb_ahs_data.jenis_pekerjaan, tb_ahs_data.satuan, tb_ahs_realisasi.kode, tb_ahs_realisasi.keterangan, tb_ahs_data.analisa_pekerjaan, SUM(tb_bahan.harga * tb_ahs_realisasi.koefisien) AS jumlah')->groupByRaw('tb_ahs_realisasi.kode, tb_ahs_realisasi.keterangan, tb_ahs_data.satuan,tb_ahs_data.jenis_pekerjaan, tb_ahs_data.analisa_pekerjaan')->orderBy('tb_ahs_data.jenis_pekerjaan')->where('tb_ahs_data.jenis_pekerjaan',$nama_pekerjaan)->where('tb_ahs_realisasi.keterangan', $lantai_data)->where('tb_ahs_realisasi.kode',$kode)->get();
        $analisa_satuan = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->leftJoin('tb_bahan', function ($join) {$join->on('id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->selectRaw('tb_bahan.kode, tb_bahan.satuan, tb_ahs_realisasi.koefisien, tb_bahan.harga ,tb_ahs_data.jenis_pekerjaan, tb_ahs_realisasi.keterangan, tb_ahs_data.analisa_pekerjaan, tb_bahan.nama, SUM(tb_bahan.harga * tb_ahs_realisasi.koefisien) AS jumlah')->groupByRaw('tb_bahan.kode, tb_bahan.satuan, tb_ahs_realisasi.koefisien, tb_bahan.harga, tb_ahs_realisasi.keterangan, tb_ahs_data.jenis_pekerjaan, tb_ahs_data.analisa_pekerjaan, tb_bahan.nama')->orderBy('tb_ahs_data.jenis_pekerjaan')->where('tb_ahs_data.jenis_pekerjaan',$nama_pekerjaan)->where('tb_ahs_realisasi.keterangan', $lantai_data)->where('tb_ahs_realisasi.kode',$kode)->get();
        $total = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->selectRaw('SUM(tb_ahs_realisasi.koefisien * tb_bahan.harga) as jumlah')->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->leftJoin('tb_bahan', function ($join) {$join->on('tb_ahs_realisasi.id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->where('tb_ahs_data.jenis_pekerjaan',$nama_pekerjaan)->where('tb_ahs_realisasi.keterangan', $lantai_data)->where('tb_ahs_realisasi.kode',$kode)->first();
        $total_persentase = AhsRealisasi::where('tb_ahs_realisasi.id_proyek', $id_proyek)->where('tb_ahs_realisasi.id_user', Auth::user()->id)->selectRaw('tb_bahan.kelompok, SUM(tb_ahs_realisasi.koefisien * tb_bahan.harga) as jumlah')->join('tb_ahs_data', function ($join) {$join->on('tb_ahs_realisasi.kode', '=', 'tb_ahs_data.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_ahs_data.id_proyek');})->leftJoin('tb_bahan', function ($join) {$join->on('tb_ahs_realisasi.id_bahan', '=', 'tb_bahan.kode')->whereRaw('tb_ahs_realisasi.id_proyek = tb_bahan.id_proyek');})->groupBy('tb_bahan.kelompok')->where('tb_ahs_data.jenis_pekerjaan',$nama_pekerjaan)->where('tb_ahs_realisasi.keterangan', $lantai_data)->where('tb_ahs_realisasi.kode',$kode)->get();
        return view('proyek.cetak_ahs_pekerjaan', ['id_proyek'=>$id_proyek, 'jenis_pekerjaan'=>$jenis_pekerjaan, 'lantai'=>$lantai,'analisa'=>$analisa, 'total'=>$total, 'analisa_satuan'=>$analisa_satuan, 'total_persentase'=>$total_persentase]);
    }

    public function ViewSetting($id_proyek)
    {
        $nama_proyek = Proyek::where('id_user', Auth::user()->id)->where('id', $id_proyek)->first();
        return view('setting', ['nama_proyek'=>$nama_proyek, 'id_proyek'=>$id_proyek]);

    }

    public function ViewRabRealisasi($id_proyek)
    {
        $data = RabRealisasi::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->get();
        $nama_proyek = Proyek::where('id_user', Auth::user()->id)->where('id', $id_proyek)->first();
        return view('proyek.rabRealisasi',['id_proyek'=>$id_proyek, 'nama_proyek'=>$nama_proyek, 'data'=>$data]);
    }

    public function addRabRealisasi(Request $request, $id_proyek)
    {
        $data = new RabRealisasi();
        $data->id_proyek = $id_proyek;
        $data->id_user = Auth::user()->id;
        $data->nama_pekerjaan = $request->nama_pekerjaan;
        $data->budget = $request->budget;
        $data->bahan = $request->bahan;
        $data->upah = $request->upah;
        $data->alat = $request->alat;
        $data->lain = $request->lain;
        $data->persentase = $request->persentase;
        $data->save();

        return redirect()->route('ViewRabRealisasi', $id_proyek);
    }

    public function deleteRabRealisasi($id_proyek, $id)
    {
        $data = RabRealisasi::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->where('id', $id)->first();
        $data->delete();

        return redirect()->route('ViewRabRealisasi', $id_proyek);
    }

    public function editRabRealisasi(Request $request, $id_proyek, $id)
    {
        $data = RabRealisasi::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->where('id', $id)->first();
        $data->id_proyek = $id_proyek;
        $data->id_user = Auth::user()->id;
        $data->nama_pekerjaan = $request->nama_pekerjaan;
        $data->budget = $request->budget;
        $data->bahan = $request->bahan;
        $data->upah = $request->upah;
        $data->alat = $request->alat;
        $data->lain = $request->lain;
        $data->persentase = $request->persentase;
        $data->update();      
        return redirect()->route('ViewRabRealisasi', $id_proyek);
    }

    public function viewEditRabRealisasi($id_proyek, $id)
    {
        $nama_proyek = Proyek::where('id_user', Auth::user()->id)->where('id', $id_proyek)->first();
        $data = RabRealisasi::where('id_proyek', $id_proyek)->where('id_user', Auth::user()->id)->where('id', $id)->first();
        return view('proyek.editRabRealisasi', ['nama_proyek'=>$nama_proyek, 'data'=>$data, 'id_proyek'=>$id_proyek]);
    }
}
